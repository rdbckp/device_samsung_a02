name: Generate Device Tree A02 Final

on:
  workflow_dispatch:

# JURUS SAKTI BIAR GAK KENA 403
permissions:
  contents: write

jobs:
  build-tree:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Device Repo
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: Create Device Tree Structure
        run: |
          DEVICE=a02
          VENDOR=samsung
          
          # 1. AndroidProducts.mk
          printf "PRODUCT_MAKEFILES := \$(LOCAL_DIR)/lineage_%s.mk\n" "$DEVICE" > AndroidProducts.mk
          printf "COMMON_LUNCH_CHOICES := lineage_%s-userdebug\n" "$DEVICE" >> AndroidProducts.mk

          # 2. BoardConfig.mk
          printf "DEVICE_PATH := device/%s/%s\n\n" "$VENDOR" "$DEVICE" > BoardConfig.mk
          printf "# Architecture\nTARGET_ARCH := arm\nTARGET_ARCH_VARIANT := armv8-a\n" >> BoardConfig.mk
          printf "TARGET_CPU_ABI := armeabi-v7a\nTARGET_CPU_ABI2 := armeabi\n" >> BoardConfig.mk
          printf "TARGET_CPU_VARIANT := generic\nTARGET_CPU_SMP := true\n\n" >> BoardConfig.mk
          printf "# Kernel\nTARGET_KERNEL_CONFIG := a02_defconfig\n" >> BoardConfig.mk
          printf "TARGET_KERNEL_SOURCE := kernel/%s/%s\n" "$VENDOR" "$DEVICE" >> BoardConfig.mk
          printf "BOARD_KERNEL_IMAGE_NAME := zImage\n\n" >> BoardConfig.mk
          printf "# Platform\nTARGET_BOARD_PLATFORM := mt6739\n\n" >> BoardConfig.mk
          printf "# Include Vendor Config\n-include vendor/%s/%s/BoardConfigVendor.mk\n" "$VENDOR" "$DEVICE" >> BoardConfig.mk

          # 3. lineage_a02.mk
          printf "\$(call inherit-product, \$(SRC_TARGET_DIR)/product/full_base_telephony.mk)\n\n" > lineage_$DEVICE.mk
          printf "# Inherit from device tree\n\$(call inherit-product, device/%s/%s/device.mk)\n" "$VENDOR" "$DEVICE" >> lineage_$DEVICE.mk
          printf "# Inherit from vendor tree\n\$(call inherit-product, vendor/%s/%s/%s-vendor.mk)\n\n" "$VENDOR" "$DEVICE" "$DEVICE" >> lineage_$DEVICE.mk
          printf "PRODUCT_NAME := lineage_%s\nPRODUCT_DEVICE := %s\n" "$DEVICE" "$DEVICE" >> lineage_$DEVICE.mk
          printf "PRODUCT_BRAND := %s\nPRODUCT_MODEL := Galaxy A02\n" "$VENDOR" >> lineage_$DEVICE.mk
          printf "PRODUCT_MANUFACTURER := %s\n" "$VENDOR" >> lineage_$DEVICE.mk

          # 4. device.mk
          printf "LOCAL_PATH := device/%s/%s\n\n" "$VENDOR" "$DEVICE" > device.mk
          printf "PRODUCT_PACKAGES += \\\\\n    android.hardware.audio.service \\\\\n    android.hardware.graphics.composer@2.1-service \\\\\n    android.hardware.sensors@1.0-service\n" >> device.mk

      - name: Commit and Push
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          git add .
          git commit -m "Initialize Device Tree for A02 [LineageOS 18.1]" || echo "No changes to commit"
          git push origin main
